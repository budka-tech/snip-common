stages:
  - build
  - deploy

build:
  stage: build
  image: oven/bun:canary-debian
  script:
    - cd status
    - bun i
    - bun run build
    - ls -R dist/
  artifacts:
    paths:
      - status/dist/go/
      - status/dist/ts/
      - status/dist/dart/

deploy_go:
  stage: deploy
  image: alpine:latest
  script:
    - apk add --no-cache git
    - git config --global user.email "cibot@stdev-cloud.ru"
    - git config --global user.name "Ci Bot"
    - mkdir common-go && cd common-go
    - git clone https://pa-khan:Didaandpes9!@gitlab.com/standart-dev/common-go.git
    - cp -r ../status/dist/go/ .
    - git add .
    - git commit -m "share"
    - git push -u origin dev
  only:
    - main
  dependencies:
    - build
#stages:
#  - mirror
#
#mirror_to_repo1:
#  stage: mirror
#  script:
#    - git remote add mirror1 https://gitlab.com/standart-dev/share-go.git
#    - git add status/dist/status/status.go
#    - git push --mirror mirror1
#  only:
#    - main  # Укажите ветку или условие
#
#mirror_to_repo2:
#  stage: mirror
#  script:
#    - git remote add mirror2 https://gitlab.com/standart-dev/share-ts.git
#    - git push --mirror mirror2
#  only:
#    - main  # Укажите другую ветку или условие